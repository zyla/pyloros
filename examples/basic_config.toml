# Pyloros Basic Configuration Example
#
# This is a sample configuration file demonstrating the allowlist-based
# filtering proxy for AI agent network access control.

[proxy]
# Address to bind the proxy server
bind_address = "127.0.0.1:8080"

# Path to CA certificate for MITM (required)
# Generate with: pyloros generate-ca --out ./certs/
ca_cert = "./certs/ca.crt"
ca_key = "./certs/ca.key"

[logging]
# Log level: error, warn, info, debug, trace
level = "info"

# Log individual requests (allowed and blocked)
# Accepts a boolean (both allowed + blocked) or a table for granular control:
#   log_requests = true
#   log_requests = false
#   log_requests = { allowed = true, blocked = false }
log_requests = { allowed = true, blocked = true }

# Allowlist Rules
# ===============
# Requests must match at least one rule to be allowed.
# All other requests are blocked by default.
#
# Pattern syntax:
# - * matches any sequence of characters (including empty, across path segments)
# - Method "*" matches any HTTP method
# - wss:// is treated as https:// for matching

# Allow health checks
[[rules]]
method = "GET"
url = "https://api.example.com/health"

# Allow reading user profiles (any user ID)
[[rules]]
method = "GET"
url = "https://api.example.com/users/*/profile"

# Allow any operation on a CDN
[[rules]]
method = "*"
url = "https://cdn.example.com/*"

# Allow GitHub API access
[[rules]]
method = "*"
url = "https://api.github.com/*"

# Allow GitHub raw content
[[rules]]
method = "GET"
url = "https://raw.githubusercontent.com/*"

# Allow specific search with query parameters
[[rules]]
method = "GET"
url = "https://api.example.com/search?q=*"

# Allow WebSocket connections to a specific endpoint
[[rules]]
method = "GET"
url = "wss://realtime.example.com/events"
websocket = true

# Credential Injection
# ====================
# Inject API keys and tokens into outgoing requests so the AI agent
# never sees real secrets. Credentials are only injected for HTTPS.
# All string values support ${ENV_VAR} placeholders.

# Inject an API key header (type defaults to "header" if omitted)
[[credentials]]
url = "https://api.anthropic.com/*"
header = "x-api-key"
value = "${ANTHROPIC_API_KEY}"

# Inject a bearer token for a private API
# [[credentials]]
# url = "https://internal.example.com/*"
# header = "Authorization"
# value = "Bearer ${INTERNAL_TOKEN}"

# Re-sign AWS requests with real credentials (AWS SigV4)
# The agent can use dummy AWS keys; the proxy re-signs transparently.
# [[credentials]]
# type = "aws-sigv4"
# url = "https://*.amazonaws.com/*"
# access_key_id = "${AWS_ACCESS_KEY_ID}"
# secret_access_key = "${AWS_SECRET_ACCESS_KEY}"
# session_token = "${AWS_SESSION_TOKEN}"
